/*
	Videobox v1 - jQuery lightbox clone for displaying iframe videos
	Based on Slimbox 2.04 
		(c) 2007-2010 Christophe Beyls <http://www.digitalia.be>
		MIT-style license.
*/

(function vb(f){var e=f(window),d,n,F=-1,b,r,s,c,E,t,o,j=!window.XMLHttpRequest,q=[],D=document.documentElement,x,C,w,v,B,l,y,a;f(function g(){f("body").append(f([x=f('<div id="vbOverlay" />')[0],C=f('<div id="vbCenter" />')[0],B=f('<div id="vbBottomContainer" />')[0]]).css("display","none"));w=f('<iframe id="vbVideo" frameborder="0" allowfullscreen="true" oallowfullscreen msallowfullscreen webkitallowfullscreen mozallowfullscreen />').appendTo(C)[0];v=f('<video controls="controls" autoplay="autoplay" name="media" id="vbVideo5" ></video>').appendTo(C)[0];l=f('<div id="vbBottom" />').appendTo(B).append([f('<a id="vbCloseLink" href="#" />').add(x).click(m)[0],y=f('<div id="vbCaption" />')[0],a=f('<div id="vbNumber" />')[0],f('<div style="clear: both;" />')[0]])[0]});f.videobox=function(J,I,H){d=f.extend({loop:false,overlayOpacity:0.8,overlayFadeDuration:400,resizeDuration:400,resizeEasing:"swing",initialWidth:250,initialHeight:250,videoWidth:640,videoHeight:363,videoFadeDuration:400,captionAnimationDuration:400,counterText:"Video {x} of {y}",closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78]},H);if(typeof J=="string"){J=[[J,I]];I=0}E=e.scrollTop()+(e.height()/2);t=d.initialWidth;o=d.initialHeight;f(C).css({top:Math.max(0,E-(o/2)),width:t,height:o,marginLeft:-t/2}).show();c=j||(x.currentStyle&&(x.currentStyle.position!="fixed"));if(c){x.style.position="absolute"}f(x).css("opacity",d.overlayOpacity).fadeIn(d.overlayFadeDuration);A();p(1);n=J;d.loop=d.loop&&(n.length>1);return G(I)};f.fn.videobox=function(I,M,K){M=M||function H(N){return[N.href,N.title]};K=K||function L(){return true};var J=this;return J.unbind("click").click(function L(){var P=this,R=0,Q,N=0,O;Q=f.grep(J,function(T,S){return K.call(P,T,S)});for(O=Q.length;N<O;++N){if(Q[N]==P){R=N}Q[N]=M(Q[N],N)}return f.videobox(Q,R,I)})};function A(){var I=e.scrollLeft(),H=e.width();f([C,B]).css("left",I+(H/2));if(c){f(x).css({left:I,top:e.scrollTop(),width:H,height:e.height()})}}function p(H){if(H){f("object").add(j?"select":"embed").each(function(J,K){q[J]=[K,K.style.visibility];K.style.visibility="hidden"})}else{f.each(q,function(J,K){K[0].style.visibility=K[1]});q=[]}var I=H?"bind":"unbind";e[I]("scroll resize",A)}function G(H){if(H>=0){F=H;b=n[F][0];C.className="vbLoading";u();h()}return false}function k(J,I,H){v.innerHTML='<source src="'+J+'.webm" type="video/webm"><source src="'+J+'.ogv" type="video/ogg"><source src="'+J+'.mp4" type="video/mp4"><source src="'+J+'.m4v" type="video/mp4">';v.setAttribute("poster",vb_site_root+"plugins/content/videobox/showthumb.php?img="+J.replace(vb_site_root,vb_site_base)+".ogv&width="+I+"&height="+H)}function i(I,J,H){v.innerHTML='<source src="'+I+'.oga" type="audio/ogg"><source src="'+I+'.mp3" type="audio/mpeg"><source src="'+I+'.webma" type="audio/webm"><source src="'+I+'.wav" type="audio/wav"><source src="'+I+'.m4a" type="audio/mp4">';v.setAttribute("poster",vb_site_root+"plugins/content/videobox/showthumb.php?img="+I.replace(vb_site_root,vb_site_base)+".oga&width="+J+"&height="+H)}function h(){C.className="";var H=n[F][2]||d.videoWidth;var P=n[F][3]||d.videoHeight;if(H>(e.width()-20)){H=e.width()-20}P=(P*H)/(n[F][2]||d.videoWidth);var L=true;var N=b.split("&t=")[0];switch(N.substr(-3)){case"mp4":f(v).css({visibility:"hidden",display:""});k(N.substr(0,N.length-4),H,P);break;case"ogv":f(v).css({visibility:"hidden",display:""});k(N.substr(0,N.length-4),H,P);break;case"ebm":f(v).css({visibility:"hidden",display:""});k(N.substr(0,N.length-5),H,P);break;case"m4v":f(v).css({visibility:"hidden",display:""});k(N.substr(0,N.length-4),H,P);break;case"oga":f(v).css({visibility:"hidden",display:""});i(N.substr(0,N.length-4),H,P);break;case"mp3":f(v).css({visibility:"hidden",display:""});i(N.substr(0,N.length-4),H,P);break;case"bma":f(v).css({visibility:"hidden",display:""});i(N.substr(0,N.length-6),H,P);break;case"wav":f(v).css({visibility:"hidden",display:""});i(N.substr(0,N.length-4),H,P);break;case"m4a":f(v).css({visibility:"hidden",display:""});i(N.substr(0,N.length-4),H,P);break;default:L=false;break}if(L){f(v).css({visibility:"hidden",display:""});f(v).width(H);f(v).height(P);var K;var J=0;if(b.indexOf("&t=")!=-1){K=b.split("&t=")[1];if(K.indexOf("h")!=-1){J=J*60+parseInt(K.split("h")[0]);K=K.split("h")[1]}if(K.indexOf("m")!=-1){J=J*60+parseInt(K.split("m")[0]);K=K.split("m")[1]}if(K.indexOf("s")!=-1){J=J*60+parseInt(K.split("s")[0])}}v.addEventListener("loadedmetadata",function O(Q){v.currentTime=J},false)}else{f(w).css({visibility:"hidden",display:""});w.src=N;f(w).width(H);f(w).height(P)}f(y).html(n[F][1]||"");f(a).html((((n.length>1)&&d.counterText)||"").replace(/{x}/,F+1).replace(/{y}/,n.length));t=parseInt(H)+20;o=parseInt(P)+20;var M=Math.max(0,E-(o/2));f(C).animate({height:o,top:M,width:t,marginLeft:-t/2},d.resizeDuration,d.resizeEasing);f(C).queue(function I(){f(B).css({width:t,top:M+o,marginLeft:-t/2,visibility:"hidden",display:""});if(L){f(v).css({display:"none",visibility:"",opacity:""}).fadeIn(d.videoFadeDuration,z);v.play()}else{f(w).css({display:"none",visibility:"",opacity:""}).fadeIn(d.videoFadeDuration,z)}})}function z(){f(l).css("marginTop",-l.offsetHeight).animate({marginTop:0},d.captionAnimationDuration);B.style.visibility=""}function u(){try{v.pause()}catch(H){}C.removeChild(v);v=f('<video controls="controls" autoplay="autoplay" name="media" id="vbVideo5" ></video>').appendTo(C)[0];f([C,w,v,l]).stop(true);f([w,v,B]).hide();w.src="";w.title=""}function m(){if(F>=0){u();F=-1;f(C).hide();f(x).stop().fadeOut(d.overlayFadeDuration,p)}return false}})(jQuery);
// AUTOLOAD CODE BLOCK (MAY BE CHANGED OR REMOVED)
	jQuery(function vb($) {
	$("a[rel^='videobox']").videobox({ /* Put custom options here */ }, function vbl(el) {
			return [el.href, el.getAttribute("title"), el.getAttribute("videowidth"), el.getAttribute("videoheight")];
	}, function vbl(el) {
	  return (this == el) || ((this.rel.length > 8) && (this.rel == el.rel));
	 });
	});