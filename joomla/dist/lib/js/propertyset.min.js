/// <reference path="jquery.d.ts" />
!function(t){function e(e,a){switch(e.attr("type")){case"radio":case"checkbox":e.each(function(){t(this).attr("value")==a?t(this).attr("checked",1):t(this).removeAttr("checked")});break;case"text":case"hidden":default:e.val(a)}}function a(t,e){for(var a=t.serializeArray(),r=0;r<a.length;r++)if(a[r].name==e)return a[r].value;return""}t(window).on("load",function(r){t("input.vb-prop-set").each(function(r,n){var i=t(n).parents("form"),c=t(n).attr("data-key"),o=t(n).attr("data-prefix"),s=t.parseJSON(t(n).val()),f=t(n).attr("id"),l=t("#"+f+"-list").find('*[data-set="'+c+'"]'),d=t("#"+f+"-key");d.on("change",function(r){var o=t(r.target).attr("name");if(o){var f=a(i,o).replace(/(^\W+)|(\W+$)/g,"").replace(/\W+/g,"-").toLowerCase();if(!f||"new"==f)return!1;e(t(r.target),f),c!=f&&(s[f]=t.extend({},s[c]),s[c]=void 0,c=f,s[c].property_set=c,e(t(n),JSON.stringify(s)),l.attr("data-set",c),l.html(c))}}),t("#"+f+"-list").find(".icon-cancel").on("click",function(a){var r=t(a.target).parents("li").attr("data-set");s[r]=void 0,e(t(n),JSON.stringify(s)),window.Joomla.submitbutton("plugin.apply")});for(var u=["input","select","textarea"],p="",v=0;v<u.length;v++)p&&(p+=", "),p+=u[v]+'[name^="'+o+'"], ',p+=u[v]+'[name*=" '+o+'"]';i.find(p).on("change select click",function(r){var o=t(r.target).attr("name");if(o){var f=a(i,o);s[c].property_set||(s[c]={property_set:c}),s[c][o]=f,e(t(n),JSON.stringify(s))}})})})}(jQuery);