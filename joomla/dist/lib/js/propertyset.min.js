/// <reference path="jquery.d.ts" />
!function(e){e(window).on("load",function(t){e("input.vb-prop-set").each(function(t,a){function n(t,a){switch(t.attr("type")){case"radio":case"checkbox":t.each(function(){e(this).attr("value")==a?e(this).attr("checked",1):e(this).removeAttr("checked")});break;case"text":case"hidden":default:t.val(a)}}function i(e){for(var t=f.find("input, select, textarea").serializeArray(),a=0;a<t.length;a++)if(t[a].name==e)return t[a].value;return""}function r(t){o=t,o&&s[o]||(o="__new",s[o]=e.extend({},s["default"]),s[o].__name="",s[o].__key=""),e.each(s[o],function(t,a){n(e('*[name="'+t+'"]'),a)})}var c=e(a).attr("id"),s=e.parseJSON(e(a).val()),l=e("#list-"+c),f=e("#fields-"+c),o="default";e.each(s[o],function(t,r){var c=e('*[name="'+t+'"]');n(c,r),c.on("change select click",function(r){var f=i(t).trim();if("__key"==t){var d=f.replace(/(^\W+)|(\W+$)/g,"").replace(/\W+/g,"-").toLowerCase();if(!d)return!1;if("default"==o)return n(c,o),!1;if(f!=d&&(f=d,n(c,d)),f==o)return!0;if(s[f])return!1}var u=e(l).find('li[data-set="'+o+'"]');u.length<1&&(u=e('<li data-set="'+o+'"><span class="set-name">'+(s[o].__name?s[o].__name:o)+'</span><span class="icon-cancel btn btn-small"></span></li>'),u.insertBefore(e(l).children(":last-child"))),"__key"==t&&(s[f]=e.extend({},s[o]),s[o]=void 0,o=f,u.attr("data-set",f)),"__name"==t&&u.find(".set-name").html(f?f:o),s[o][t]=f,n(e(a),JSON.stringify(s))})}),e(l).on("click","li .set-name",function(t){var a=this;r(e(a).parent().attr("data-set"))}),e(l).on("click","li .icon-cancel",function(t){var i=this,c=e(i).parent().attr("data-set");s[c]&&(s[c]=void 0),e(i).parent().remove(),n(e(a),JSON.stringify(s)),c==o&&r("default")})})})}(jQuery);