/// <reference path="jquery.d.ts" />
!function(t){function e(e,a){switch(e.attr("type")){case"radio":case"checkbox":e.each(function(){t(this).attr("value")==a?t(this).attr("checked",1):t(this).removeAttr("checked")});break;case"text":case"hidden":default:e.val(a)}}function a(t,e){for(var a=t.serializeArray(),r=0;r<a.length;r++)if(a[r].name==e)return a[r].value;return""}t(window).on("load",function(r){t("input.vb-prop-set").each(function(r,n){var i=t(n).parents("form"),c=t(n).attr("data-key"),o=t.parseJSON(t(n).val()),s=t(n).attr("id"),l=t("#"+s+"-list").find('*[data-set="'+c+'"]'),f=t("#"+s+"-key");f.on("change select click",function(r){var s=t(r.target).attr("name");if(s){var f=a(i,s).replace(/(^\W+)|(\W+$)/g,"").replace(/\W+/g,"-").toLowerCase();if(!f||"new"==f)return!1;e(t(r.target),f),c!=f&&(o[f]=t.extend({},o[c]),o[c]=void 0,c=f,o[c].property_set=c,e(t(n),JSON.stringify(o)),l.attr("data-set",c),l.html(c))}}),t("#"+s+"-list").find(".icon-cancel").on("click",function(a){var r=t(a.target).parents("li").attr("data-set");o[r]=void 0,e(t(n),JSON.stringify(o)),window.Joomla.submitbutton("plugin.apply")}),i.find("input, select, textarea").on("change select click",function(r){var s=t(r.target).attr("name");if(s){var l=a(i,s);o[c].property_set||(o[c]={property_set:c}),o[c][s]=l,e(t(n),JSON.stringify(o))}})})})}(jQuery);